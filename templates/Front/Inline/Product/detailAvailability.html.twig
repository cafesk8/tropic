{% import 'Front/Content/Product/deliveryDateMacro.html.twig' as deliveryDate %}

{% macro availibilityDetail(product, setDisplayNone) %}
    <div class="{% if setDisplayNone is same as (true) %}display-none {% endif %}box-detail__availability js-detail-availability js-detail-availability-{{ product.id }}">
        <span class="box-detail__availability__status">
            {{ deliveryDate.productAvailabilityWithDeliveryDate(product) }}
        </span>

        {% set stocksWithoutZeroQuantityOnPickupPlaceStore = product.stocksWithoutZeroQuantityOnPickupPlaceStore(getDomain()) %}
        {% if stocksWithoutZeroQuantityOnPickupPlaceStore|length > 0 %}
            <span class="box-detail__availability__text">
                {{ 'nebo ihned na '}}
            </span>
            <a
                href="#"
                class="box-detail__availability__stores js-detail-availability-window-opener"
                data-product-id="{{ product.id }}"
                >
                {% transchoice stocksWithoutZeroQuantityOnPickupPlaceStore|length with { '%stocksWithoutZeroQuantityOnStoreCount%': stocksWithoutZeroQuantityOnPickupPlaceStore|length } %}
                {1} %stocksWithoutZeroQuantityOnStoreCount% prodejně|
                [2,Inf] %stocksWithoutZeroQuantityOnStoreCount% prodejnách
                {% endtranschoice %}
            </a>
        {% endif %}
        <div class="display-none js-availability-table_{{ product.id }}">
            <table class="table-main full-width">
                <thead>
                <tr>
                    <th>{{ 'Prodejna'|trans }}</th>
                </tr>
                </thead>
                <tbody>
                {% for storeWithStock in stocksWithoutZeroQuantityOnPickupPlaceStore %}
                    <tr>
                        <td>{{ storeWithStock.store.name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endmacro %}


{% if product.variants|length > 0 %}
    <div class="box-detail__availability">
        <span class="box-detail__availability__status">
            <span class="box-detail__availability__date">
                {{ 'Skladem, ihned k odeslání'|trans }}
            </span>
        </span>
    </div>
    {% for variant in product.variants %}
        {{ _self.availibilityDetail(variant, true) }}
    {% endfor %}
{% else %}
    {{ _self.availibilityDetail(product, false) }}
{% endif %}
