{% import 'Front/Content/Product/deliveryDateMacro.html.twig' as deliveryDate %}

{% macro availabilityDetail(product, setDisplayNone) %}
    <div class="{% if setDisplayNone is same as (true) %}display-none {% endif %}in-availability in-availability--big js-detail-availability js-detail-availability-{{ product.id }}">
        <span class="in-availability__status">
            {{ deliveryDate.productAvailabilityWithDeliveryDate(product) }}
        </span>

        {% set stocksWithoutZeroQuantityOnPickupPlaceStore = product.stocksWithoutZeroQuantityOnPickupPlaceStore(getDomain()) %}
        {% if stocksWithoutZeroQuantityOnPickupPlaceStore|length > 0 %}
            <span class="in-availability__text-big">
                {{ 'nebo ihned na '}}
            </span>
            <a
                href="#"
                class="in-availability__stores-big underline-small js-detail-availability-window-opener"
                data-product-id="{{ product.id }}"
                >
                {% transchoice stocksWithoutZeroQuantityOnPickupPlaceStore|length with { '%stocksWithoutZeroQuantityOnStoreCount%': stocksWithoutZeroQuantityOnPickupPlaceStore|length } %}
                {1} %stocksWithoutZeroQuantityOnStoreCount% prodejně|
                [2,Inf] %stocksWithoutZeroQuantityOnStoreCount% prodejnách
                {% endtranschoice %}
            </a>
        {% endif %}
        <div class="display-none js-availability-table_{{ product.id }}">
            <table class="table-main full-width">
                <thead>
                <tr>
                    <th>{{ 'Prodejna'|trans }}</th>
                </tr>
                </thead>
                <tbody>
                {% for storeWithStock in stocksWithoutZeroQuantityOnPickupPlaceStore %}
                    <tr>
                        <td>{{ storeWithStock.store.name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endmacro %}


{% if variants|length > 0 or product.variants|length > 0 %}
    <div class="in-availability in-availability--big js-product-variant-detail-select-info">
        <span class="in-availability__status">
            <span class="in-availability__date">
                {% if distinguishingParameterValuesForProducts(product.variants) is empty %}
                    {{ deliveryDate.productAvailabilityWithDeliveryDate(product) }}
                {% else %}
                    {{ 'Pro zobrazení dostupnosti vyberte variantu'|trans }}
                {% endif %}
            </span>
        </span>
    </div>
    {% for variant in variants if variant in product.variants %}
        {{ _self.availabilityDetail(variant, true) }}
    {% endfor %}
{% else %}
    {{ _self.availabilityDetail(product, false) }}
{% endif %}
