{% macro productAvailabilityWithDeliveryDate(product) %}
        {% set domain = getDomain() %}
        {% set deliveryDate = getDeliveryDate(product) %}
        {% set showDeliveryDate = product.usingStock
            and product.stockQuantity > 0
            and deliveryDate is not null  %}

        {% set showNotAvailable = product.usingStock
            and product.stockQuantity < 1
            and not product.outOfStockAction is same as(constant('OUT_OF_STOCK_ACTION_SET_ALTERNATE_AVAILABILITY', product)) %}

        {% if showDeliveryDate %}
            {% set expectedDeliveryDate = deliveryDate %}
            {% set friendlyDayInterval = expectedDeliveryDate.diff(date()) %}
            <span class="box-detail__availability__date">
                {{ expectedDeliveryDate|friendlyDay }}
                {% if friendlyDayInterval.days >= 2 %}
                    {{ expectedDeliveryDate|date('j. n.') }}
                {% endif %}
                {{ 'u&nbsp;tebe'|trans|raw }}
            </span>
        {% elseif showNotAvailable %}
            <span class="box-detail__availability__date box-detail__availability__date--not-available">{{ 'Momentálně nedostupné'|trans }}</span>
        {% else %}
            <span class="box-detail__availability__date">{{ product.calculatedAvailability.name }}</span>
        {% endif %}
{% endmacro %}
