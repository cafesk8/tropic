{% extends '@ShopsysShop/Front/Layout/layoutWithoutPanel.html.twig' %}
{% import '@ShopsysShop/Front/Content/Product/productListMacro.html.twig' as productList %}

{% block meta_robots -%}
    <meta name="robots" content="noindex, follow">
{% endblock %}

{% block title %}
    {{ 'Cart'|trans }}
{% endblock %}

{% block breadcrumb %}
{% endblock %}

{% block infoRow %}
{% endblock %}

{% block main_content %}
    <div class="web__line">
        <div class="web__container web__container--big-padding">

            {% if cart is not null %}
                {{ form_start(form, { attr: { class: 'js-no-validate js-cart-form' }}) }}
                    <div class="box-order">
                        <div class="box-order__info">
                            <div class="box-order__info__top">
                                <div class="box-order__info__top__left">
                                    <div class="in-action in-action--with-back-icon in-action--centered-on-mobile">
                                        <i class="svg svg-triangle"></i>
                                        <a href="{{ url('front_homepage') }}" class="in-action__back underline">
                                            {{ 'Zpìt do e-shopu'|trans }}
                                        </a>
                                    </div>
                                </div>
                                <div class="box-order__info__top__right">
                                    {% if isFreeTransportAndPaymentActive %}
                                        {% if isPaymentAndTransportFree %}
                                            <div class="in-free-transport in-free-transport--centered-on-mobile">
                                                <span class="in-free-transport__title__important">{{ 'Máte dopravu zdarma!'|trans }}</span>
                                            </div>
                                        {% else %}
                                            <div class="in-free-transport in-free-transport--centered-on-mobile">
                                                <div class="in-free-transport__title">
                                                    {{ 'Nakupte ještì za '|trans }} <span class="in-free-transport__title__price">{{ remainingPriceWithVat|price }}</span>&nbsp;{{ 'a'|trans }}<br>
                                                    {{ 'máte'|trans }} <span class="in-free-transport__title__important">{{ 'dopravu zdarma!'|trans }}</span>
                                                </div>
                                                <div class="in-free-transport__pipe">
                                                    <div class="in-free-transport__pipe__line" style="width: 40%;"></div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            {{ form_errors(form) }}
                            <div class="table-cart js-cart">
                                {% for index, cartItem in cartItems %}
                                    {% set cartItemPrice = cartItemPrices[index] %}
                                    {% set cartItemDiscount = cartItemDiscounts[index] %}
                                    <div class="table-cart__row js-cart-item">
                                        <div class="table-cart__row__left">
                                            <div class="table-cart__cell__image">
                                                <a href="{{ url('front_product_detail', {id: cartItem.product.id}) }}" title="{{ cartItem.product.name }}">
                                    				{{ image(cartItem.product.productForCreatingImageAccordingToVariant, { size: 'thumbnail' }) }}
                                                </a>
                                            </div>
                                            <div class="table-cart__cell__name js-cart-item-name">
                                                <a class="table-cart__cell__name__title" href="{{ url('front_product_detail', {id: cartItem.product.id}) }}" title="{{ cartItem.name }}">
                                                    {{ cartItem.name }}
                                                </a>
                                                <span class="table-cart__cell__name__text">
                                                    {{ 'Barva'|trans }}: Light Olive
                                                </span>
                                                <span class="table-cart__cell__name__text">
                                                    {{ 'Velikost'|trans }}: <span class="in-badge in-badge--outline js-not-implemented-yet" title="">36</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="table-cart__row__right">
                                            <div class="table-cart__cell__spinbox">
                                                <span class="form-input-spinbox js-spinbox">
                                                    {{ form_widget(form.quantities[cartItem.id], { attr: { class: 'form-input-spinbox__input input-no-style js-spinbox-input', 'data-spinbox-min': 1}}) }}
                                                    <label class="form-input-spinbox__label">{{ 'Kusù'|trans }}</label>
                                                    <div class="btn-no-style form-input-spinbox__btn js-spinbox-plus"><i class="svg svg-plus"></i></div>
                                                    <div class="btn-no-style form-input-spinbox__btn form-input-spinbox__btn--minus js-spinbox-minus"><i class="svg svg-minus"></i></div>
                                                </span>

                                                <a
                                                    href="{{ url('front_cart_delete', {cartItemId: cartItem.id, _token: csrf_token('front_cart_delete_' ~ cartItem.id)}) }}"
                                                    class="table-cart__cell__spinbox__link js-cart-item-remove-button"
                                                >
                                                    {{ 'Odstranit'|trans }}
                                                </a>

                                            </div>
                                            <div class="table-cart__cell__price js-cart-item-total-price">
                                                {% if cartItemDiscount is not null %}
                                                    <div class="table-cart__cell__price__line-through">
                                                        {{ cartItemDiscount.priceWithVat|price }}
                                                    </div>
                                                {% endif %}
                                                <div class="table-cart__cell__price__primary">
                                                    {{ cartItemPrice.totalPrice.priceWithVat|price }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <div class="box-cart-bottom">
                                <div class="box-cart-bottom__promo">
                                    {{ render(controller('ShopsysShopBundle:Front/PromoCode:index')) }}
                                </div>
                            </div>

                            <div class="box-order__additional js-not-implemented-yet">
                                <div class="box-order__additional__title">
                                    {{ 'Pøihoïte si k nákupu'|trans }}
                                </div>
                                {# TODO PRG: add additional products to list #}
                                {#{ productList.horizontalList(cartItems, "list-basket-additionals", 'h3', 'basket-additionals') }#}
                            </div>
                        </div>
                        <div id="js-order-preview" class="box-order__cart" data-url="{{ url('front_order_preview') }}">
                            {{ render(controller('ShopsysShopBundle:Front/Order:preview',{
                                orderStep: "1"
                            })) }}
                        </div>
                    </div>
                    {% do form.submit.setRendered %}
                {{ form_end(form) }}
            {% else %}
                <div class="box-cart-empty">
                    <div class="box-cart-empty__image">
                        <img src="{{ asset('assets/frontend/images/empty-cart.png') }}" alt="{{ 'Empty cart'|trans }}">
                    </div>
                    <div class="box-cart-empty__text">
                        {{ 'Your cart is unfortunately empty. To create order, you have to <a href="%url%">choose</a> some product first'|transHtml({ '%url%': url('front_homepage') }) }}
                    </div>
                </div>

                <div class="in-action">
                    <div class="in-action__left">
                        <a href="{{url('front_homepage') }}" class="btn in-action__btn">
                            {{ 'Back to buying'|trans }}
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
